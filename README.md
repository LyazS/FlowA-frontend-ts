# FlowA-frontend-ts

## 新方向
仿造comfyui的调试

缓存键通常由节点类型和输入参数生成，确保唯一性。

cfui每次运行会缓存节点在内存
使用ws来同步数据

fa呢？用sse来同步，用http来请求

增量运行/全量运行
统一一下

## 架构设计
前端只做展示，后端只做计算

前端只需要维持一个wid，然后总是展示最新的tid？
前端编辑节点，然后发送运行，
后端收到执行，sse返回运行状态

数据库只是一个缓存作用
再加版本管理

### 增量执行
* 节点检验
* 节点计算hash值，然后搜索数据库是否存在他的缓存，有则加载缓存，否则执行计算
* 计算完成后，将结果缓存到数据库
* 计算hash值需要计算他的前置节点的hash值，递归计算
### 全量执行
* 执行前，先将当前工作流的历史记录全部清空
* 再按照增量来执行

## 加载与返回编辑
### 加载
* 创建新工作流(x)
* 上传工作流(x)
* 切换工作流
* 初始化页面
* 从版本记录返回编辑器时
### 返回编辑
* 上述加载都要切回编辑模式
* 切回编辑模式要检查是否在运行中，然后强行切到运行模式

我在用vscode构建一个digraph
我在设计一个状态机，有三种状态：编辑、运行、查看
有以下操作：
* （任何状态）创建新工作流->编辑模式
* （任何状态）上传工作流（load）->编辑模式
* （任何状态）切换工作流（load）->编辑模式->（视后端状态）运行模式
* （任何状态）查看版本记录（loadR）->查看模式
* 初始化页面（load）->编辑模式->（视后端状态）运行模式
* （查看状态）返回编辑器时->编辑模式->（视后端状态）运行模式
* （编辑模式）运行工作流->运行模式
* （查看/编辑状态）加载版本记录->编辑模式